/*!
 * 
 *     MCAFEE RESTRICTED CONFIDENTIAL
 *     Copyright (c) 2025 McAfee, LLC
 *
 *     The source code contained or described herein and all documents related
 *     to the source code ("Material") are owned by McAfee or its
 *     suppliers or licensors. Title to the Material remains with McAfee
 *     or its suppliers and licensors. The Material contains trade
 *     secrets and proprietary and confidential information of McAfee or its
 *     suppliers and licensors. The Material is protected by worldwide copyright
 *     and trade secret laws and treaty provisions. No part of the Material may
 *     be used, copied, reproduced, modified, published, uploaded, posted,
 *     transmitted, distributed, or disclosed in any way without McAfee's prior
 *     express written permission.
 *
 *     No license under any patent, copyright, trade secret or other intellectual
 *     property right is granted to or conferred upon you by disclosure or
 *     delivery of the Materials, either expressly, by implication, inducement,
 *     estoppel or otherwise. Any license under such intellectual property rights
 *     must be expressed and approved by McAfee in writing.
 *
 */(()=>{"use strict";const e="FOCUS_OR_CREATE_TAB",t="FOCUS_TAB",n="CONNECT_TO_WPS_NATIVE",s="OPEN_NEW_OR_NAV_TO_URL",o="SHOW_SIDEBAR_MAIN",i="DFD_SET_STATUS",a="PONG_SEND_DATA",r="CLOSE_PAGE",l="PING_CONTENT_SITE_LISTENER",c=0,d=23,u=24,g=36,m=37,h=38,p=39,_=41,E=0;const N=0,f="PRINT_IN_BACKGROUND",y={NONE:0,INFO:1,ERROR:2,WARN:3,DEBUG:4,ALL_IN_BACKGROUND:99},T=1,b=2,O=3,L=4,R={BACKGROUND:"BACKGROUND",CONTENT:"CONTENT",TELEMETRY:"TELEMETRY"},F={DEFAULT:"color: #000000; font-weight: normal; font-style:normal; background: #FFFFFF;",BACKGROUND:"color: #8D0DBA; font-weight: bold; background: #FFFFFF;",CONTENT:"color: #F54A26; font-weight: bold; background: #FFFFFF;",TELEMETRY:"color: #147831; font-weight: bold; background: #FFFFFF;"};const A=new class{constructor(){this.storageChecked=!1,this.logLevel=null,this.queue=[];const e="MCLOGLEVEL";chrome?.storage?.local.get([e]).then(t=>{const n=Object.values(y).includes(t[e]);this.logLevel=n?t[e]:N,this.logLevel!==y.NONE&&this.queue.forEach(({callback:e,message:t,processType:n})=>{e(t,n)}),this.queue=[],this.storageChecked=!0})}log(e,t=null){this.storageChecked?this.processLog(e,T,t,this.logLevel):this.queue.push({callback:this.log.bind(this),message:e,processType:t})}error(e,t=null){this.storageChecked?this.processLog(e,b,t,this.logLevel):this.queue.push({callback:this.error.bind(this),message:e,processType:t})}warn(e,t=null){this.storageChecked?this.processLog(e,O,t,this.logLevel):this.queue.push({callback:this.warn.bind(this),message:e,processType:t})}debug(e,t=null){this.storageChecked?this.processLog(e,L,t,this.logLevel):this.queue.push({callback:this.debug.bind(this),message:e,processType:t})}processLog(e,t,n,s){if(s===y.NONE)return;let o="chrome-extension:"===location.protocol?R.BACKGROUND:R.CONTENT;n&&R[n]&&(o=n);const i=this.formatDateWithMilliseconds(new Date),a=t===b?e:`%c[${o} ${i} ]: %c${e}`;o===R.CONTENT&&this.logLevel===y.ALL_IN_BACKGROUND&&chrome.runtime.sendMessage({command:f,logMessage:a,processType:o,logType:t,logLevel:s}),this.printLog(a,o,t,s)}formatDateWithMilliseconds(e){return`${new Intl.DateTimeFormat("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0}).format(e)}.${e.getMilliseconds().toString().padStart(3,"0")}`}printLog(e,t,n,s){const o=F.DEFAULT,i=F[t]||o;if(s>=y.ERROR&&n===b&&console.error(e),s>=y.INFO&&n===T&&console.log(e,i,o),s>=y.WARN&&n===O){const t="color: #FFA500; font-family: sans-serif; font-weight: bolder; text-shadow: #000 1px 1px;";console.log(`%cWARN - ${e}`,t,i,o)}if(s>=y.DEBUG&&n===L){const t="color: #FF33D7; font-family: sans-serif; font-weight: bolder; text-shadow: #000 1px 1px;";console.log(`%cDEBUG - ${e}`,t,i,o)}}};class w{constructor(e){this.pingCommand=e,this.basePingListener(),this.addIdentifier()}basePingListener(e=null){((e,t=null,n)=>{"function"==typeof n?chrome.runtime.onMessage.addListener((s,o,i)=>{if(o.id===chrome.runtime.id&&"object"==typeof s&&!Array.isArray(s)&&s?.ipcId===e)return n({promises:t,request:s,sender:o,sendResponse:i})}):A.error("Provided with invalid callback function")})("WA",null,({request:t,sendResponse:n})=>{const{command:s}=t;if(s===this.pingCommand)return A.debug(`File Injection [pinged]: Received ${s} command`),n({content:!0}),"function"==typeof e&&e(),!0})}addIdentifier(){var e;e=()=>{const e=document.createElement("span");e.id=this.pingCommand,e.style.cssText="display:none",document.body.appendChild(e)},"undefined"!=typeof document&&null!==document&&("complete"===document.readyState||"loading"!==document.readyState&&!document.documentElement.doScroll?e():document.addEventListener("DOMContentLoaded",e))}}const C=async(e,t,n,s)=>{try{chrome.tabs.sendMessage(s,{ipcId:e,command:t,...n},{},()=>{chrome.runtime.lastError})}catch(e){A.warn(`[broadcast] Unexpected error when calling command: "${t}", err: ${e.message}`)}},I=(e,t,n,s,o=null)=>{if(!chrome.tabs)throw new Error('"tabs" permission not set in manifest.');const i={};return"number"==typeof o&&(i.frameId=o),chrome.tabs.sendMessage(s,{ipcId:e,command:t,...n},i)},v=(e,t={},n)=>(async(e,t,n={},s={})=>{try{if(s?.tabId){const{tabId:o,frameId:i}=s;return await I(e,t,n,o,i)}if(s?.broadcast){const o=await chrome.tabs.query({}),{broadcastIgnoreId:i=[]}=s;return o.filter(({id:e})=>!i.includes(e)).forEach(({id:s})=>{C(e,t,n,s)}),!0}return await chrome.runtime.sendMessage({ipcId:e,command:t,...n})}catch(e){return A.warn(`Unexpected error when calling command: "${t}", err: ${e.message}`),null}})("WA",e,t,n),D={NONE:0,LINKEDIN:1,INSTAGRAM:2,YOUTUBE:4,FACEBOOK:8,TWITTER:16,REDDIT:32},S=(Object.values(D).reduce((e,t)=>e+t),{NONE:"NONE",ONLY_SECURE_SEARCH:"ONLY_SECURE_SEARCH",ALL:"ALL",*[Symbol.iterator](){for(const e of Object.keys(this))yield e}}),{NONE:U,...k}=D,q={name:"FINGER_PRINT",type:"number"},P={name:"FIRST_PARTY",type:"number"},$={name:"THIRD_PARTY",type:"number"},M=chrome,B=(Symbol.iterator,"8.1.0.6747"),G=(M.runtime.getURL(""),q.name,P.name,$.name,"not_ready");(new class extends w{constructor(){super(l)}async getPongDataWhenReady(){let e=null;return await((e,t,n)=>{const s=async(t,o)=>{await n()?o(!0):t<=0?o(!1):setTimeout(()=>{s(t-1,o)},e)};return new Promise(e=>{s(t,e)})})(1e3,5,async()=>{const t=await v(a);if(null===t)return A.log("[content_site_listener:main]: still setting up extension, data is not yet available."),!1;e=t;const n=e&&null!==e?.wps_installed&&null!==e?.wa_native_enabled;A.log(`[content_site_listener:main]: check native status ${n} - ${JSON.stringify(e||{})}`);let s=!0;return e?.wps_installed&&(s=null!==e?.dfd_status),e.dfd_status=e.dfd_status||G,n&&s}),e}async main(){window.addEventListener("message",async a=>{if(!a)return void A.log("[content_site_listener:main]: res is null");const{data:l}=a;if(!l)return void A.log("[content_site_listener:main]: data is null");const{request_type:N,payload:f}=l;if(void 0!==N&&void 0!==f){if(N===c&&!f.done){A.log("[content_site_listener:main]: received a Ping request, retrieving Pong data");const e=await this.getPongDataWhenReady();if(null===e)return void A.log("[content_site_listener:main]: ignore pong data = null");A.log(`[content_site_listener:main]: Pong data ready: ${JSON.stringify(e)}`),window.postMessage({request_type:E,payload:{done:!0,...e,version:B}},a.origin)}if(N===d){A.log("[content_site_listener:main]: opening settings page");const t=chrome.runtime.getURL("html/settings.html");v(e,{url:t})}else if(N===u){const{contentId:e}=f;A.log(`[content_site_listener:main]: received an action panel request for ${e}`),v(o,{contentId:e})}else N===m?(A.log("[content_site_listener:main]: received an open/nav URL request"),v(s,{payload:f})):N===h?(A.log("[content_site_listener:main]: received a request to focus tab"),v(t,{payload:f})):N===g?(A.log("[content_site_listener:main]: received a request to connect to wps"),v(n)):N===p?(A.log(`[content_site_listener:main]: DFD set status message ${JSON.stringify(f)}`),v(i,{payload:f})):N===_&&(A.log(`[content_site_listener:main]: Closing tab with payload: ${JSON.stringify(f)}`),v(r,{payload:f}))}else A.log("[content_site_listener:main]: requestType or payload is undefined")},!1)}}).main()})();
//# sourceMappingURL=../sourceMap/chrome/scripts/content_site_listener.js.map